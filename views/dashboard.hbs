<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Gymate</title>
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="dash.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
</head>

<body>
    <nav id="navi" role="navigation red" class="nav" data-email={{user.profile.email}}>
        <div class="nav-wrapper container">
            <a id="logo-container" href="#" class="brand-logo">
                <img src="gm-white.png" id="logo">
            </a>
            <ul class="right">{{#if user}}

                {{/if}}</ul>
            <ul class="right">
                {{#if user}}
                <a style="color:red" href="/logout">Sign out</a>
                {{else}}
                <a style="color:red" href="/login">Sign in</a>
                {{/if}}
            </ul>
            <ul class="right">{{#if user}}
                <a style="color:red" href="/profile">
                    Profile
                </a>
                {{/if}}</ul>
        </div>
    </nav>

    <br>

    <div class="container" id="main">

        <div class="card-panel">
            <span class="card-title">Popular Routines</span>
            <div class="carousel">
            </div>
        </div>

        <div class="row">
            <div class="col s6">
                <div class="card-panel">
                    <span class="card-title">You vs. Buddy</span>
                    <table class=“centered”>
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Date</th>
                                <th>Hours (Month)</th>
                                <th>Pounds Loss (Month)</th>
                            </tr>
                        </thead>

                        <tbody>
                            <tr>
                                <td>You</td>
                                <td>7/11/2019</td>
                                <td>50</td>
                                <td>10</td>
                            </tr>
                            <tr>
                                <td>Gabe</td>
                                <td>7/11/2019</td>
                                <td>50</td>
                                <td>10</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="col s6">
                <div class="card-panel">
                    <span class="card-title">Posts</span>
                    <div class="row">
                        <form class="col s12">
                            <div class="row">
                                <div class="input-field col s12">
                                    <textarea id="textarea1" class="materialize-textarea"></textarea>
                                    <label for="textarea1">How was your workout?</label>
                                    <button id="send-post" class="btn waves-effect waves-light" type="submit"
                                        name="action">Send</button>
                                </div>
                            </div>
                        </form>
                    </div>
                    <ul class="collection"></ul>
                </div>
            </div>
        </div>
    </div>


    <nav role="navigation red" class="nav">
        <div class="nav-wrapper container">
            <div class="container center">
                <footer>© 2019 Copyright</footer>
            </div>
        </div>
    </nav>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
</body>

<script>
    var colors = ["red", "yellow", "green", "blue", "orange", "purple"];
    var idFromEmail;

    function getUser(id, cb) {
        $.get("api/users/" + id).
            then(function (data) {
                console.log(data);
                cb(data)
            });
    };

    function getUserByEmail(email) {
        $.get("api/users/email/" + email).
            then(function (data) {
                idFromEmail = data.id;
            });
    };

    function displayAllPosts() {
        $.get("api/posts").
            then(function (data) {

                console.log(data);
                for (var i = 0; i < data.length; i++) {

                    cb = function (i, userData) {
                        var post = $("<li class='collection-item avatar'>");
                        var imgId = "post-img" + i;
                        var nameId = "post-name" + i;
                        var contentId = "post-content" + i;

                        post.append(`<img id='${imgId}' class='circle'>`);
                        post.append(`<span id='${nameId}' class='title'></span>`);
                        post.append(`<p id='${contentId}'>`);

                        $(".collection").append(post);

                        $("#" + imgId).attr('src', userData.profilePhoto);
                        $("#" + nameId).text(userData.name);
                        $("#" + contentId).text(data[i].content);


                    }
                    getUser(data[i].UserId, cb.bind(null, i));
                }
            });


    };

    var buddyId;
    var userId = 1;
    var routineIndex;
    var selected = false;

    var Routine1 = ["Chest, Back, Shoulders, Legs, Biceps, Triceps", "Rest", "Rest", "Legs, Triceps, Biceps, Chest, Back, Shoulder", "Rest", "Shoulders, Back, Chest, Legs, Triceps, Biceps", "Rest"];
    var Routine2 = ["Chest, Shoulders and Triceps", "Back and Biceps", "Rest", "Legs", "Rest", "Shoulders, chest, and Triceps", "Back and Bis", "Rest"];
    var Routine3 = ["Chest & Back", "Legs", "Shoulders & Arms", "Rest", " Chest, Shoulders, & Triceps", "Back & Biceps", " Legs"];
    var Routine4 = ["Chest, Shoulders and Triceps", "Back and Biceps", "Rest", "Legs", "Rest", "Shoulders, chest, and Triceps", "Back and Bis", "Rest"];
    var Routine5 = ["Chest, Shoulders and Triceps", "Back and Biceps", "Rest", "Legs", "Rest", "Shoulders, chest, and Triceps", "Back and Bis", "Rest"];

    $(".carousel").append("<a class='carousel-item'>R1</a>");
    $(".carousel").append("<a class='carousel-item'>R2</a>");
    $(".carousel").append("<a class='carousel-item'>R3</a>");
    $(".carousel").append("<a class='carousel-item'>R4</a>");
    $(".carousel").append("<a class='carousel-item'>R5</a>");
    $(".carousel-item").each(function (index) {
        $(this).attr("style", `background: ${colors[index]};`)
    });



    var routineArr = [Routine1, Routine2, Routine3];

    function updateUserRoutine(userId) {

    }

    function addRoutine(routine) {

        console.log(routine);

        for (var i = 0; i < 7; i++) {
            var dailyRoutine =
            {
                dayOfTheWeek: i + 1,
                routine: routine[i],
                UserId: userId
            }

            $.ajax({
                method: "POST",
                url: "/api/routines/" + userId,
                data: dailyRoutine
            }).then(function (data) {

                console.log(data);
            });
        }

    }


    $(document).ready(function () {
        getUserByEmail($("#navi").data().email);
        console.log(idFromEmail);

        $(".routine").click(function (e) {

            routineIndex = parseInt($(this).attr("data-index"));
            console.log(routineIndex);
            if (!selected) {
                addRoutine(routineArr[routineIndex]);
                selected = true;
            }
            else {

            }

        });

        $('.carousel').carousel();
        displayAllPosts();

        $("#send-post").on("click", (e) => {
            e.preventDefault();

            var contentToPost = $("#textarea1").val().trim();
            // if(!contentId) {
            //     alert()
            // }
            $("#textarea1").val("");
            $("#textarea1").next().removeClass("active");

            var postText = {

                content: contentToPost,
                userId: idFromEmail,
            };

            $.post("api/posts", postText).
                then(function (data) {

                    console.log(data);

                    alert("Adding post...");
                });
            $(".collection").empty();
            displayAllPosts();
        });
    });
</script>

</html>